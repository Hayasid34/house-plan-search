# DandoriFinder - 住宅プラン検索システム

住宅会社向けの過去プラン検索システムです。PDFファイル名から自動的にプラン情報を抽出し、簡単に検索・閲覧できます。

## 📋 機能

### ✅ 実装済み

#### 1. AI自動解析（NEW! 推奨）
- **Claude 3.5 Sonnet** による高精度な図面解析
- PDFをアップロードするだけで自動的に情報を抽出
- 精度: 95%以上
- 抽出項目: 延床面積、間取り、階数、進入方向、敷地面積、特徴
- 信頼度スコア（0-100%）付きで解析精度を表示
- 抽出結果を確認・修正してから登録可能

#### 2. ファイル名からの自動抽出
- PDFファイル名から建物坪数、間取り、進入方向、敷地面積、特徴を自動抽出
- 99%以上の精度でデータ化（命名ルール遵守時は100%）
- ファイル名形式: `{建物坪数}_{間取り}_{階数}_{進入方向}_{敷地面積}_{特徴1-特徴2-特徴3...}.pdf`
- 特徴は無制限に追加可能（ハイフン区切り）

#### 3. 簡単アップロード
- ドラッグ&ドロップ対応
- 複数ファイルの一括アップロード
- アップロード前のプレビュー・検証機能
- ファイル名の正誤チェック

#### 4. 高度な検索機能
- 間取り検索（2LDK、3LDK、4LDK等）
- 面積検索（最小坪数・最大坪数）
- 特徴検索（吹抜け、WIC、ロフト、SIC等）
- 複数条件の組み合わせ検索

#### 5. PDFプレビュー
- ブラウザ内で図面を直接表示
- モーダルでの詳細表示
- PDFダウンロード機能

#### 6. 直感的なUI
- ダンドリワークのブランドカラーを使用した統一感のあるデザイン
- レスポンシブ対応（PC・タブレット・スマートフォン）
- カード形式のプラン一覧表示
- ローディング状態の表示

### 🚧 次フェーズで実装予定
- データベース移行（JSON → PostgreSQL）
- PDFサムネイル自動生成
- ユーザー認証・権限管理
- マルチテナント対応（複数企業）
- クラウドストレージ連携（AWS S3）

## 🚀 起動方法

### 前提条件
- Node.js 20.x 以上
- npm または yarn
- Anthropic API Key（AI自動解析機能を使う場合のみ）

### インストール & 起動

#### 1. 依存関係のインストール

\`\`\`bash
# プロジェクトディレクトリに移動
cd /Users/dw1003/house-plan-search

# 依存関係をインストール（初回のみ）
npm install
\`\`\`

#### 2. Anthropic API Keyの設定

**AI自動解析機能を使用するには、Anthropic API Keyが必要です。**

##### API Keyの取得

1. [Anthropic Console](https://console.anthropic.com/settings/keys) にアクセス
2. ログインまたはアカウント作成
3. 「Create Key」をクリックしてAPI Keyを生成
4. 生成されたAPI Key（`sk-ant-api03-...`で始まる文字列）をコピー

##### 環境変数の設定

プロジェクトルートの `.env.local` ファイルを開いて、API Keyを設定：

\`\`\`bash
# .env.local
ANTHROPIC_API_KEY=sk-ant-api03-xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
\`\`\`

**⚠️ 重要**: `your_api_key_here` というプレースホルダーのままにしないでください。
実際のAPI Keyに置き換えてください。

##### ファイル名モードのみ使用する場合

AI自動解析を使用せず、ファイル名からの抽出のみ使う場合は、API Keyの設定は不要です。

#### 3. 開発サーバーの起動

\`\`\`bash
# 開発サーバーを起動
npm run dev
\`\`\`

開発サーバーが起動したら、ブラウザで以下にアクセス：
- **ローカル**: http://localhost:3000
- **ネットワーク**: http://192.168.11.18:3000

## 🎨 使い方

### 1. プランをアップロード

#### オプション A: AI自動解析（推奨）

1. トップページの「プランを追加」ボタンをクリック
2. 「AI自動解析（推奨）」を選択
3. PDFファイルをドラッグ&ドロップ（または選択）
4. AIが自動的に図面を解析（数秒〜10秒程度）
5. 抽出結果を確認・必要に応じて修正
6. 「アップロード」ボタンでプランを登録

**メリット**:
- ファイル名の命名ルールを気にする必要なし
- 既存のPDFファイルをそのままアップロード可能
- 信頼度スコアで解析精度を確認できる

#### オプション B: ファイル名から登録

1. トップページの「プランを追加」ボタンをクリック
2. 「ファイル名から登録」を選択
3. 命名ルールに従ったファイル名のPDFをアップロード
4. ファイル名が自動解析され、内容が表示される
5. 「アップロード」ボタンをクリック

**ファイル名の命名ルール:**
```
{建物坪数}_{間取り}_{階数}_{進入方向}_{敷地面積}_{特徴1-特徴2-特徴3...}.pdf
```

**例:**
- `32.5坪_3LDK_2階建て_南_50坪.pdf` （特徴なし）
- `38坪_4LDK_2階建て_東_60坪_吹き抜け.pdf` （特徴1つ）
- `28坪_2LDK_平屋_北_45坪_WIC-ロフト-SIC.pdf` （特徴3つ）
- `35坪_3LDK_2階建て_南東_55坪_吹き抜け-WIC-パントリー-和室-ウッドデッキ.pdf` （特徴5つ・無制限）
- `-_3LDK_-_南_-坪_吹き抜け.pdf` （不明な項目は `-` で入力可能）

**メリット**:
- 100%の精度（命名ルール遵守時）
- AI APIキー不要

### 2. プランを検索

1. 検索フォームで条件を指定
   - 間取り（プルダウンから選択）
   - 坪数範囲（最小〜最大）
   - 特徴キーワード（カンマ区切りで複数指定可能）
2. 自動的に検索結果が表示される

### 3. プラン詳細を確認

1. プランカードをクリック
2. モーダルで詳細情報とPDF図面が表示される
3. 「PDFをダウンロード」ボタンでダウンロード可能

### 4. よく使われる特徴キーワード

**無制限に追加可能（ハイフン区切り）：**
- 吹き抜け
- WIC（ウォークインクローゼット）
- ロフト
- SIC（シューズインクローゼット）
- パントリー
- 小屋裏収納
- 和室
- ウッドデッキ
- バルコニー
- 書斎
- テラス
- 土間

**進入方向：**
- 東・西・南・北・北東・北西・南東・南西

**例：** `35坪_3LDK_南東_55坪_吹き抜け-WIC-パントリー-和室-ウッドデッキ.pdf`

## 🏗️ 技術スタック

### フロントエンド
- **Next.js 15** - Reactフレームワーク（App Router使用）
- **TypeScript 5** - 型安全な開発
- **Tailwind CSS 3** - ユーティリティファーストCSS
- **React 18** - UIライブラリ

### AI & 画像処理
- **@anthropic-ai/sdk** - Claude 3.5 Sonnet API
- **pdf2pic** - PDFから画像への変換
- **Vision AI** - 図面の自動解析・情報抽出

### PDF処理
- **react-pdf** - PDFプレビュー表示
- **pdfjs-dist** - PDF.jsコアライブラリ

### ファイル管理
- **formidable** - ファイルアップロード処理
- **Next.js API Routes** - バックエンドAPI

### データストレージ（パイロット版）
- **JSON ファイル** - シンプルなデータ保存
- ファイルシステムストレージ（public/uploads）

### デザインシステム
- ダンドリワーク公式カラーパレットを完全実装
- レスポンシブデザイン
- アクセシビリティ対応

## 📁 プロジェクト構造

\`\`\`
house-plan-search/
├── app/
│   ├── page.tsx                # トップページ（検索・一覧）
│   ├── upload/                 # アップロードページ
│   │   └── page.tsx
│   ├── api/                    # API Routes
│   │   └── plans/
│   │       ├── route.ts        # プラン取得API
│   │       └── upload/
│   │           └── route.ts    # アップロードAPI
│   ├── layout.tsx              # ルートレイアウト
│   └── globals.css             # グローバルスタイル
├── components/
│   ├── PlanCard.tsx            # プランカード
│   ├── PlanUpload.tsx          # アップロードコンポーネント
│   └── SearchForm.tsx          # 検索フォーム
├── lib/
│   ├── parseFilename.ts        # ファイル名解析ユーティリティ
│   └── plansData.ts            # データ管理ユーティリティ
├── data/
│   └── plans.json              # プランデータ（JSON）
├── public/
│   └── uploads/                # アップロードされたPDF
├── tailwind.config.js          # Tailwind設定（カラーパレット）
├── tsconfig.json               # TypeScript設定
└── package.json                # 依存関係
\`\`\`

## 🎨 カラーパレット

ダンドリワークの公式カラーパレットを使用：
- **ブランドカラー**: #0078C8 (D-blue)
- **ボタン**: Primary, Secondary, Error状態
- **テキスト**: Primary, Sub, Disable, Placeholder
- **背景**: Light, Soft, Medium, Selected, Active
- **ライン**: Focused, Error, Success, Separator
- **ラベル**: 8種類のアクセントカラー

## 🔧 次のステップ

### フェーズ2: データベース移行（1-2ヶ月）
- [ ] PostgreSQL セットアップ
- [ ] データ移行スクリプト
- [ ] パフォーマンス最適化

### フェーズ3: PDF機能強化（2-3ヶ月）
- [ ] PDFサムネイル自動生成
- [ ] 複数ページPDF対応
- [ ] クラウドストレージ連携（AWS S3）

### フェーズ4: AI解析機能強化
- [x] Vision AI統合（Claude 3.5 Sonnet）✅ 完了
- [x] 図面内情報の自動抽出 ✅ 完了
- [x] 間取り特徴の自動検出 ✅ 完了
- [ ] 複数ページPDF対応
- [ ] より詳細な特徴抽出の拡張

### フェーズ5: 認証・マルチテナント（6ヶ月以降）
- [ ] ユーザー認証（NextAuth.js）
- [ ] 企業別データ分離
- [ ] 権限管理
- [ ] 1,000社対応のスケーラビリティ

## 📝 開発コマンド

\`\`\`bash
# 開発サーバー起動
npm run dev

# ビルド
npm run build

# 本番サーバー起動
npm run start

# Linter実行
npm run lint
\`\`\`

## 🐛 トラブルシューティング

### API Key関連のエラー

**エラー**: `ANTHROPIC_API_KEYが正しく設定されていません`

**解決方法**:
1. `.env.local` ファイルを開く
2. `ANTHROPIC_API_KEY=your_api_key_here` を実際のAPI Keyに置き換える
3. API Keyは `sk-ant-api03-...` で始まる文字列です
4. 開発サーバーを再起動（`Ctrl+C` で停止後、`npm run dev` で再起動）

\`\`\`bash
# サーバーを停止
Ctrl + C

# サーバーを再起動
npm run dev
\`\`\`

**注意**: 環境変数を変更した場合は、必ず開発サーバーの再起動が必要です。

### ポート3000が使用中の場合
\`\`\`bash
# 別のポートで起動
PORT=3001 npm run dev
\`\`\`

### 依存関係エラー
\`\`\`bash
# node_modulesを削除して再インストール
rm -rf node_modules package-lock.json
npm install
\`\`\`

### PDF解析が遅い

- 初回解析時は、PDFから画像への変換とAI解析で10秒程度かかる場合があります
- 解析中は「AI解析中」のステータスが表示されます
- ファイルサイズが大きい場合（10MB以上）は、さらに時間がかかることがあります

## 📄 ライセンス
プロトタイプ - 内部使用のみ

## 👥 作成者
Claude Code による自動生成プロトタイプ
